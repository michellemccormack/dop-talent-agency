<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DOP Debug</title>
  <style>
    body { 
      font-family: monospace; 
      padding: 20px; 
      background: #1a1a1a; 
      color: #0f0; 
    }
    pre { 
      background: #000; 
      padding: 20px; 
      border: 1px solid #0f0; 
      overflow-x: auto;
      white-space: pre-wrap;
    }
    img { 
      max-width: 300px; 
      border: 2px solid #0f0; 
      margin: 10px 0;
    }
    .error { color: #f00; }
    .success { color: #0f0; }
    h2 { color: #0ff; }
  </style>
</head>
<body>
  <h1>DOP Debug Tool</h1>
  <div id="output">Loading...</div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const dopId = urlParams.get('id');
    const output = document.getElementById('output');

    if (!dopId) {
      output.innerHTML = '<p class="error">No DOP ID provided. Use ?id=dop_xxxxx</p>';
    } else {
      output.innerHTML = '<h2>DOP ID: ' + dopId + '</h2>';
      
      // Load persona
      fetch('/.netlify/functions/dop-persona?id=' + encodeURIComponent(dopId))
        .then(res => res.json())
        .then(persona => {
          output.innerHTML += '<h2>✅ Persona loaded successfully</h2>';
          output.innerHTML += '<pre>' + JSON.stringify(persona, null, 2) + '</pre>';
          
          // Test image loading
          if (persona.images && persona.images[0]) {
            const imgUrl = persona.images[0].url;
            output.innerHTML += '<h2>Testing Image Load:</h2>';
            output.innerHTML += '<p>URL: ' + imgUrl + '</p>';
            
            const img = document.createElement('img');
            img.src = imgUrl;
            img.onload = () => {
              output.innerHTML += '<p class="success">✅ Image loaded successfully</p>';
            };
            img.onerror = (e) => {
              output.innerHTML += '<p class="error">❌ Image failed to load</p>';
              output.innerHTML += '<pre>' + JSON.stringify(e, null, 2) + '</pre>';
            };
            output.appendChild(img);
          }
          
          // Test voice URL
          if (persona.voices && persona.voices[0]) {
            const voiceUrl = persona.voices[0].url;
            output.innerHTML += '<h2>Voice URL:</h2>';
            output.innerHTML += '<p>' + voiceUrl + '</p>';
            output.innerHTML += '<audio controls src="' + voiceUrl + '"></audio>';
          }
        })
        .catch(error => {
          output.innerHTML += '<h2 class="error">❌ Error loading persona</h2>';
          output.innerHTML += '<pre class="error">' + error.message + '</pre>';
        });
    }
  </script>
</body>
</html>
