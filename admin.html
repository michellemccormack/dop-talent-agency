<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DOP Admin — Recent uploads</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:24px;}
    h1{margin:0 0 12px;}
    .note{color:#555;margin:0 0 16px;}
    table{border-collapse:collapse;width:100%;}
    th,td{border:1px solid #eee;padding:10px;text-align:left;font-size:14px;vertical-align:top;}
    th{background:#fafafa;}
    code{background:#f6f6f6;padding:2px 6px;border-radius:6px;}
    .err{color:#b00020;margin-top:12px;}
  </style>
</head>
<body>
  <h1>Recent DOP uploads</h1>
  <p class="note">
    Append <code>?key=YOUR_ADMIN_KEY</code> to this page’s URL.  
    Example: <code>/admin.html?key=adm_8d2e3c9b7a4b4f6cbd1b9d8a3c</code>
  </p>
  <div id="out">Loading…</div>
  <script>
    const params = new URLSearchParams(location.search);
    const key = params.get('key');
    const out = document.getElementById('out');

    async function run() {
      if (!key) { out.innerHTML = '<div class="err">Missing ?key=…</div>'; return; }
      const endpoint = '/.netlify/functions/dop-list-recent?key=' + encodeURIComponent(key);
      const resp = await fetch(endpoint);
      const data = await resp.json().catch(()=> ({}));
      if (!resp.ok) { out.innerHTML = '<div class="err">' + (data.error || 'Error') + '</div>'; return; }
      if (!data.items || data.items.length === 0) { out.textContent = 'No uploads yet.'; return; }

      const rows = data.items.map(item => {
        const files = item.files.map(f =>
          `<div><code>${f.key}</code> <small>(${(f.size||0).toLocaleString()} bytes)</small></div>`
        ).join('');
        return `<tr>
          <td><code>${item.dopId}</code><div><a href="/dop/${item.dopId}">/dop/${item.dopId}</a></div></td>
          <td>${new Date(item.updatedAt).toLocaleString()}</td>
          <td>${(item.bytesTotal||0).toLocaleString()}</td>
          <td>${files}</td>
        </tr>`;
      }).join('');

      out.innerHTML = `
        <table>
          <thead>
            <tr><th>dopId</th><th>Updated</th><th>Total bytes</th><th>Files</th></tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>`;
    }
    run();
  </script>
</body>
</html>
